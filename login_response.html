





<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	
			


<meta name="description" content="EMWD is your power hub for customer self service web portals supplying electrical energy to residential, commercial and industrial customers.">
<meta name="keywords" content="EMWD, MyAccount, deregulation, heating, energy, power, utility, appliance, range, stove, dryer, water heater, air conditioning, fireplace, home improvement, renovation, electricity, electric power, electric energy, electric generation, electric meter, customer service, electric bill, residential electric rates, business electric rates, energy audit, kilowatt, kilowatt hour, kWh, bill payment information, electrical usage rates, rates, bill payment information, electrical information, electricity information, electrical services">
	
	



	
	
	
	<script src="/PortalV4.0/js/jquery.min.js"></script>
	


	<link href="/PortalV4.0/css/cap.min.css" rel="stylesheet" type="text/css">
	
    

	<link href="/PortalV4.0/capricornCustom.css" rel="stylesheet" type="text/css">
	<link rel="shortcut icon" href="/PortalV4.0/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">


	<title>EMWD :: My Account Login</title>

	

	
</head>

<body onLoad="initFields(); getAccountNo();">








	<!-- ************************** START OF CUSTOM HEADER ************************** -->
  <meta name="google-site-verification" content="UVicC7rgqQC9RfrFR2r06HqEFj7IMeXmeKRq-c37gww">
  <link type="text/css" rel="stylesheet" media="all" href="/sites/default/themes/dtheme/dist/theme.min.css">
  <style>
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) { 
  .page-footer .footer-band:after {
    background-image: url(/sites/default/themes/dtheme/img/footer-band.png) !important;
  }
}
@supports (-ms-ime-align:auto) or (-ms-accelerator:true) {
  .page-footer .footer-band:after {
    background-image: url(/sites/default/themes/dtheme/img/footer-band.png) !important;
  }
}

.quicklinks {
	top:25px !important;
}
@media(max-width: 767px){
	.quicklinks {
		top:0 !important;
	}
	.quicklinks a {
		margin-top: 5px !important;
	}
}
  </style>
  <script type="text/javascript" async="" src="https://www.google-analytics.com/plugins/ua/linkid.js"></script>
  <script async="" src="//www.google-analytics.com/analytics.js"></script>
  <link rel="stylesheet" type="text/css" href="https://s3.amazonaws.com/assets.freshdesk.com/widget/freshwidget.css?ver=2">

 
  
  <div class="accessibility">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>
  </div>
  <div class="page">
    <header class="page-header headroom not-top unlocked bottom">
      <div class="header-top">
        <div class="header-top-inner">
          <div class="branding">
            <div class="logo">
              <a class="large-logo" href="https://www.emwd.org" title="Back to home" rel="home" target="www"><img class="screen" src="/sites/default/themes/dtheme/img/logo.svg" alt="Eastern Municipal Water District"></a>
              <a class="small-logo" href="https://www.emwd.org" title="Back to home" rel="home" target="www"><img class="screen" src="/sites/default/themes/dtheme/img/logo-sm.svg" alt="Eastern Municipal Water District"></a>
            </div>
            <div class="name">
              <a href="https://www.emwd.org" title="Back to home" rel="home" target="www">Eastern Municipal Water District</a>
            </div>
            <div class="slogan">EMWD</div>
            <div class="mission">Eastern Municipal Water District (EMWD) is the water, wastewater service and recycled water
              provider to Riverside County.</div>
          </div>
          <div class="toolbar" role="presentation">
            <button class="menu-icon"><span>Menu</span></button>
          </div>
        </div>
      </div>
      <div class="header-bottom">
        <div class="header-bottom-inner">
          <div class="utilities">

          </div>
          <div class="quicklinks">
            <a href="/contact-us" title="Contact Us" class="button" target="contactUs">Contact Us</a>
          </div>
          <nav class="primary-navigation ready" id="navigation"></nav>
        </div>
      </div>
    </header>
    <span class="overlay"></span>
	<!--
    <main class="page-main" tabindex="-1">
      <div class="page-center layout">
        <div id="content" class="page-content" role="region" aria-label="title"> -->
<!-- ************************** END OF CUSTOM HEADER ************************** -->



<div class="capricorn-container container">



	
	
	
	
	<div class="panel panel-danger">
		<div class="panel-heading">
			<h4>Your Login and/or Password is not valid.<br>Please try again.</h4>
		</div>
	</div>
	

	
	
	
	<p><strong><span style="font-size:14px;"></span></strong><span style="font-size:14px;"><strong>How to view and pay your bill.</strong>&nbsp;<a href="https://youtu.be/EsC3CDugtko"><span style="color:#00A9E0;">Watch the video</span></a>.&nbsp; &nbsp;&nbsp;<strong>Trouble seeing the &ldquo;Continue&rdquo; button in MyAccount?</strong>&nbsp;<a aria-label="PDF" href="https://www.emwd.org/sites/main/files/file-attachments/myaccount_portal_screen_visibility_help.pdf"><span style="color:#00A9E0;">Click here for a How-To Guide</span></a>.&nbsp; &nbsp;&nbsp;<strong>EMWD offers several payment assistance programs to help customers bring accounts current.</strong>&nbsp;<a href="https://www.emwd.org/payment-assistance-programs"><span style="color:#00A9E0;">Click here to learn more.</span></a>&nbsp; &nbsp;<strong>Want to Pay by Phone? Account Balance and Bill Payment&nbsp;&ndash; </strong><span style="color:#00A9E0;">Call: 951-383-6055</span><strong><span style="color:#00A9E0;"></span></strong>&nbsp;&nbsp;</span><strong><span style="font-size:14px;"></span></strong></p>

	

	
	<div class="row">
	
	
		
		
		    
			
			
					<!-- Login Panel -->
					<div class="col-md-6">
						<h3 id="login_heading"><i class="fa fa-lock" aria-hidden="true"></i> My Account Login</h3>
						<div class="well">
							<form id="login-form" role="form" name="login" method="post" action="/app/capricorn?para=index">
								<input type="hidden" name="jspCSRFToken" value="4eb56ad0785b68f39828ada7a04b06e70e2185fd" />
								<div class="capricorn-login-form-group form-group">
									<label for="accessCode" class="control-label">Username</label>
									<div class="controls"> <input type="text" class="form-control" id="accessCode" name="accessCode" autocorrect="off" autocapitalize="none" placeholder="Username"> </div>
								</div>
								<div class="capricorn-login-form-group form-group">
									<label for="password" class="control-label">Password</label>
									<div class="input-group">
										<input type="password" class="form-control" id="password" name="password" maxlength="60" placeholder="Password" autocomplete="new-password">
										<span id="show_pass_btn" toggle="#password" class="input-group-addon toggle-password" style="cursor: pointer;"><i class="fa fa-eye"></i></span>
									</div>
								</div>
								
			
								<div class="form-actions">	
									<button type="submit" class="pull-right btn btn-primary btn-lg" id="login_btn">Login <span class="glyphicon glyphicon-log-in"></span></button>
								</div>
								<div class="checkbox" style="max-width: 50%;">
									<label> 
										<input type="checkbox" title="rememberMyAccountNumber" name="rememberMyAccountNumber" class="" value="Y" /> Remember me  
									</label>
								</div>
			
								<div><a href="https://www.emwd.org/contact-us" target="_blank" id="capricorn-login-help-link">Need help logging in?</a></div>
								<hr>
								
								<div class="form-actions">	
									<a href="/app/capricorn?para=quickPay" type="button" class="pull-right btn btn-success btn-lg" id="quick-pay-button" >Quick Pay <span class="glyphicon glyphicon-credit-card"></span></a>
								</div>
								
								<div class="capricorn-login-form-group">
									<div><a id="capricorn-forgot-password-link" href="/app/forgotPassword.jsp">Forgot your password?</a></div>
									<div><a id="capricorn-forgot-user-link" href="/app/forgotAccessCode.jsp">Forgot your username?</a></div>
									
								</div>
								
								<input type="hidden" name="nextPara" value="" />
								<input type="hidden" name="nextPara_attr1" value="" />
							</form>				
						</div>			
					</div>
					
					<!-- Signup Panel -->
					<div class="col-md-6">
						<h3 id="login_register_heading"><i class="fa fa-plus-square" aria-hidden="true"></i> Register</h3>
						<div class="well">
							<p>Creating a username gives you access to your account details as well as water usage information.</p>

<ul style="list-style:none;">
	<li><i class="fa fa-bar-chart" aria-hidden="true"></i> - View your water usage data </li>
	<li> <i class="fa fa-file-pdf-o" aria-hidden="true"></i> - View and pay your bills online </li>
	<li><i class="fa fa-user" aria-hidden="true"></i> - Add multiple accounts to your web profile</li>
</ul>
<br>
<p>Before you get started, please have your most recent bill available to complete the registration form.</p>

							<hr>
							<form role="form">
								<div class="button-set clearfix">
									<a href="register.jsp" type="button" class="pull-right btn btn-primary btn-lg" id="capricorn-login-signup">Register Now <span class="glyphicon glyphicon-check"></span> </a>
								</div>
							</form>
						</div>		
					</div>
				
			
				
			
			
		
	
	
	
	</div> <!-- ./row -->
	
	
	
	

	
	<div class="row" style="margin-top:12px;">
	<div class="col-md-6">
		<div class="well">
			<h3 style="margin-top:0;">Are you a new customer?</h3>
			<h4>Fill out our online <a href="../ApolloWE/ctl?para=publicRequest&workflowProcess=CAUV2&WE_LANG=EN" target="newApp">Application for New Service</a></h4>
		</div>
	</div>	
	<div class="col-md-6">
		<div class="well" style="min-height:122px;">
			<h4><i class="fa fa-tint" aria-hidden="true"></i> <a href="../ApolloWE/ctl?para=publicRequest&workflowProcess=RUV1&TYPE=PUBLIC&WE_LANG=EN" target="abuseForm">Report Water Waste</a></h4>
		</div>
	</div>
</div>
<div class="row" style="margin-bottom:12px;">
	<div class="col-md-4 center-text" style="background-color:#5cb85c;color:#FFF;padding:24px;">
		<a href="https://www.emwd.org/stay-waterwise" style="color:#FFF;" target="_blank">
		<i class="fa fa-leaf fa-2x" aria-hidden="true"></i><br>
		Stay WaterWise
		</a>
	</div>
	<div class="col-md-4 center-text" style="background-color:#00A9E0;color:#FFF;padding:24px;">
		<a href="https://www.emwd.org/rates-and-fees" style="color:#FFF;" target="_blank">
		<i class="fa fa-table fa-2x" aria-hidden="true"></i><br>
		Water Budgets & Rates
		</a>
	</div>
	<div class="col-md-4 center-text  " style="background-color:#1a2f97;color:#FFF;padding:24px;">
               <a href="https://www.emwd.org/payment-assistance-programs" style="color:#FFF;" target="_blank">
               <i aria-hidden="true" class="fa fa-medkit fa-2x"></i><br />
               Payment Assistance Programs </a></div>
			   

  </div>

	

	
	
		<div class="text-center">
			 	<a href="#" class="btn btn-default btnSwitchLanguage"> Espa�ol </a>
		</div>
	


</div>
<!-- ./container -->









	<!-- ************************** START OF CUSTOM FOOTER ************************** -->
	<!--
        </div>
      </div>
    </main> -->
    <span class="footprint"></span>
    <footer class="page-footer">
      <div class="footer-band"></div>
      <div class="footer-wrapper"></div>
    </footer>
  </div>
  
  <script src="/sites/default/themes/dtheme/dist/theme.min.js" async></script>
<!-- ************************** END OF CUSTOM FOOTER ************************** -->
















	<script src="/PortalV4.0/js/cap.min.js" type="text/javascript"></script>
	




<script src="/PortalV4.0/js/custom.js" type="text/javascript"></script>

<script type="text/javascript">


//change the moment locale globally based on the language code.
moment.locale('en');


function showProcessingDialog(processingBarLabel) {
	if(processingBarLabel != null && processingBarLabel !== ''){
		$("#processingBarLabel").html(processingBarLabel);
	}
	$("#processingDialog").modal('show');
}

function hideProcessingDialog(){
	$("#processingDialog").modal('hide');
}

$(document).ready(function() {
	var secureFlag = true;

	/* Close the scotch panel (left-menu) while clicking on iframe contents. */
	$('body, .tabContentWrapper').on('click', function(e){
		if(window.parent.dashboardScotchPanel !== undefined){			
			window.parent.dashboardScotchPanel.close();
		}
	});

	
	
	$("head").append("<link href='//fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>");
	
	
    
    
	
	// =========================================
    
	// JS codes for topIncludeV3.jsp
	//$("#subtabs, #xs-subtabs").buttonset();
	
	$("#subtabs input[type=radio], #xs-subtabs input[type=radio]").change(function() {
	    // 330-694 Kubra changes for EMWD support generic landing page and open page in new window instead of iframe via opttar
	    // CAP-833: Modified logic for subMenu(TopNavigationMenu) to support the optionTarget value and behave accordingly.
	    // Possible targetOption values are: _top, _parent, _blank, and any custom value.
	    // _top and _parent would open the response in the same tab.
	    // _blank and custom target value would open the response in the new tab.
		var optionTarget = $(this).attr("data-opttar");
		if ('_parent' === optionTarget ) { // same tab
			window.parent.location.href = $(this).attr("rel") + '&opttar='+optionTarget;
			return false;
	
		} else if ('_top' === optionTarget ) { // same tab
			window.top.location.href = $(this).attr("rel") + '&opttar='+optionTarget;
			return false;
		
		} else if (('_blank' === optionTarget) || ('' != optionTarget) ) { // new tab for _blank target or any other customized target
			window.open($(this).attr("rel") + '&opttar='+optionTarget, optionTarget) ;
			var _this = this;
			setTimeout(function() { $(_this).parent().removeClass('active') ;}); // trick to deselect the radio
			
		} else {
			showProcessingDialog();
			window.location.href = $(this).attr("rel");			
		}
		
	});
	// END JS codes for topIncludeV3.jsp
	// =========================================
    
   $('#SMCONSUM').click(function() {
     	showProcessingDialog();
   });
   $('#SMARTCON').click(function() {
     	showProcessingDialog();
   });
   
   $('a[rel*=blockUI]').click(function() {
    	showProcessingDialog();
   });


	// Setup jQuery button styling
	$( "input:submit, input:button, a, button", ".buttonV2" ).button();
	$( "a", ".buttonV2" ).click(function() { return false; });

	// Setup shadows
	$('.box.standard').shadow();
	$('.box.lifted').shadow('lifted');
	$('.box.perspective').shadow('perspective');
	$('.box.raised').shadow('raised');
	$('.box.sides-vt-1').shadow({type:'sides',sides:'vt-1'});
	$('.box.sides-vt-2').shadow({type:'sides',sides:'vt-2'});
	$('.box.sides-hz-1').shadow({type:'sides',sides:'hz-1'});
	$('.box.sides-hz-2').shadow({type:'sides',sides:'hz-2'});
	$('.box.rotated').shadow({type:'rotated',rotate:'-5deg'});	

	// Help text dialog
    $(".helpLink").click(function () {
        $("#helpDialog").attr('src', $(this).attr("href"));
        $("#helpDiv").dialog({
            width: 640,
            height: 450,
            modal: true,
            close: function () {
                $("#helpDialog").attr('src', "about:blank");
            }
        });
        return false;
    }); 
    
    // change number: 252-013
	var f=navigator.userAgent.search("Firefox");
	var c=navigator.userAgent.search("Chrome");
	var ie=navigator.userAgent.search("MSIE") + (navigator.userAgent.search(/Trident/)); // MSIE for older ie and Trident for newer IE such as IE 11
	var ie9=navigator.userAgent.search("MSIE 9.0");
    
    // set the zoom level from cookie
    var cookie_name = "zoom_level";
    var index = document.cookie.indexOf(cookie_name);
    var zoomlvl = 100;
    
	// change number: 252-013
	// write cookies
	function write_cookie_for_zoom(zoomLevel)	{
		$.cookie(cookie_name, zoomLevel,  { path: '/', expires: 3650, secure: secureFlag });
	}
    
    if (index >= 0) {
    	zoomlvl = Number(document.cookie.substring(index).split(";")[0].split("=")[1]);
    	 
    	if(zoomlvl!=100){
    		zoom(zoomlvl);
    	}

    }else{
   		/*console.log("Cookie not Found at the beginning.");*/
    }
 
   // zoom in the page
   $("#zoom_in_page").click(function () {
        // max zoom level is 150%
        if(zoomlvl>= 150){
          return;
        }
        zoomlvl += 10;
        zoom(zoomlvl);
   });
   
   // zoom out the page
   $("#zoom_out_page").click(function () {
   		// min zoom level is 70%
        if(zoomlvl<=70){
          return;
        }
    	zoomlvl -= 10;
    	zoom(zoomlvl);
   });
   
   // zoom back
   $("#back_to_original_page").click(function () {
    	zoomlvl = 100;
    	zoom(zoomlvl);
   });
   

   function zoom(zoomlvl){
	   	if(f>-1){ // for firefox, use css3: transform:scale
	        $("body").css({
	      			"-moz-transform": "scale(" + zoomlvl/100 + ")",
	     			"-moz-transform-origin": "0 0"
	   		});
	        var viewPortWidth = $(window).width();
	   		var currMainContentWrapperWidth = viewPortWidth * (zoomlvl/100);
	   		var mainContentWidthDiff = (currMainContentWrapperWidth - viewPortWidth) / 2;
			if(mainContentWidthDiff>50){ /* zoom in */
		   		$("body").css("left", "-" + mainContentWidthDiff + "px");
			}else if(mainContentWidthDiff<50){  /* zoom out */
		   		$("body").css("left", mainContentWidthDiff + "px");
			}
	   		
	    }else if(ie9>-1){ // for ie9
	    	$("body").css({
	 			"transform": "scale(" + zoomlvl/100 + ")",
				"transform-origin": "0 0",
				"-ms-transform": "scale(" + zoomlvl/100 + ")",
				"-ms-transform-origin": "0 0"
			});
	    
	    }else{  // for other browers, use zooming
	   	  $("body").css("zoom", zoomlvl+"%");
	  	  if(ie>-1){  // for ie, re-position the div to center
	  		 $("body").css("width", "100%");
	  	  	
	  	     // center the viewport in the center if there is scroll bar in the window.
	  	     var newPosition =  ($(document).width() - $(window).width())/2;
	  	   	 window.scrollTo(newPosition,0);
	      }
	   	}
	   	write_cookie_for_zoom(zoomlvl);
   }
   
   
   
		$(".btnSwitchLanguage").on('click', function(e){
			var ajaxUrl = "/app/capricorn?para=switchLanguage";
			
			var language = "ES";
			$.ajax({
				type: "post",
			    cache: false,
				url: ajaxUrl,
				data: {
					"language" : language
				}
			}).done(function(){
				// cookie will expire in 10 years...
				$.cookie("emwd.org_language", language,  { expires: 3650, secure: secureFlag });
				
				if(window.location.href.indexOf('/capricorn') > -1){
					window.location.replace("/app");
				}else{
					window.location.reload();
				}
				
			});
			
		});	

 
   
  
  
  
  
  function onElementHeightChange(elm, callback){
		
		if(elm == null)
			return;
		var index = 0;
		var lastHeight = elm.clientHeight, newHeight;
	    (function run(){
	        newHeight = elm.clientHeight;
	        
	        
	        if( lastHeight != newHeight || (lastHeight == newHeight && !iframeHeightAdjusted))
	            callback();
	        lastHeight = newHeight;

	        if( elm.onElementHeightChangeTimer )
	            clearTimeout(elm.onElementHeightChangeTimer);

	        //console.log('run' + (index++));
	        elm.onElementHeightChangeTimer = setTimeout(run, 500);
	    })();
	    
	    // #330-300 - 2018-11-15 : Enhance the performance by reducing the workload. Cancel the resize function in 10 seconds.
	    
	    if( elm.onElementHeightChangeTimer ){
	    	setTimeout( function(){
	    		clearTimeout(elm.onElementHeightChangeTimer);
	    		//console.log('clear timeout');
	    	}, 5000);
	    }
	}
  
  onElementHeightChange(document.body, function(){
		resizeIFrameWhenBodyHeightChanges();
	  });  	
  	//setTimeout(resizeIFrameWhenBodyHeightChanges, 2000);
   
	
	$(document).on('click', ".logoff", function(e){
	 	e.preventDefault();
	 	$("#form-logoff").submit();
	});
  	
}); /* end jQuery.document.ready() */




var iframeHeightAdjusted = (typeof $.cookie("googtrans") == 'undefined' || $.cookie("googtrans") === "/en/en");


// 2017-06-06 @hli: Resize current active iframe according to its own content height when the page finishes loading.
// 2017-08-14 @grohman: Account for new dashboard nav.
function resizeIFrameWhenBodyHeightChanges(){
	  var $frametabs = parent.$('.iframetab');
	  var currentFrame;
	  $frametabs.each(function(){ 
		  var $iframeTabContainer = $(this).closest(".tab-pane");
		  if($iframeTabContainer.css("display") != "none"){ // all other iframes are invisible. Find the current active iframe.
			  currentFrame = $(this);
			  currentFrame.load(resizeIframe()); // reload the current iframe size.
			  return;
		  }
	  });
	  
	  // reload iframe according to the content size.
	  function resizeIframe() {
	  	  var frameBodyElment = currentFrame.contents().find("body")[0];
	  	  if(frameBodyElment == undefined){
	  		  return;
	  	  }
		  var contentHeight = frameBodyElment.offsetHeight;
		  
		  var myScotchNav = parent.document.getElementById('myAccountTabs');
		  if(typeof myScotchNav !== 'undefined'){
			  if(contentHeight < myScotchNav.offsetHeight){
				  contentHeight = myScotchNav.offsetHeight;
			  }
		  }
		  
		  
		  
		  if(!iframeHeightAdjusted){
		  	 currentFrame.height(contentHeight+1);
		  	 iframeHeightAdjusted = true;
		  }
				  
		  // CAP-997 V4 - Default height of Iframes
		  // Get the iframe padding height from menu option code and para from above java code.  
		  // Compare it with contentHeight and take the larger one to set the default page height.
		  var iframePaddingHeight = 0;
		  var maxHeight = contentHeight;
		  if(iframePaddingHeight > contentHeight) {
			  maxHeight = iframePaddingHeight;
	      
			  resizeInnerIframe(maxHeight); 
		  }
		  
		  currentFrame.height(maxHeight + 1);
		  
	  }
	  
	  
	  function resizeInnerIframe(outerIframeHeight){
	  	  var innerFrame = $(".heightAdjustedInnerIframe");
		  if(innerFrame[0]){
			  innerFrame[0].height = calculateHeightInnerIframe(outerIframeHeight);
		  }
	  }
	  
	  
	  function calculateHeightInnerIframe(outerIframeHeight){
		  var subtabs = $("#subtabs");
		  var subtabsVertical = $("#xs-subtabs");
		  if(subtabs[0] || subtabsVertical[0]){
			  return calculateHeightWithSubTabs(subtabs, subtabsVertical, outerIframeHeight);
		  } else{
			  return calculateHeightWithoutSubTabs(outerIframeHeight);
		  }
	  }
	  
	 function calculateHeightWithSubTabs(subtabs, subtabsVertical, outerIframeHeight){
		  var subtabsHeight = subtabs[0].offsetHeight;
		  var subtabsVerticalHeight = subtabsVertical[0].offsetHeight;
		  var innerHeight = outerIframeHeight;
		  
		  
		  if(subtabsHeight != 0){
			  innerHeight -= (subtabsHeight + 70);
		  } else if(subtabsVerticalHeight != 0){
			  innerHeight -= (subtabsVerticalHeight + 70);
		  }
		  
		  return innerHeight;
	 }
	 
	 function calculateHeightWithoutSubTabs(outerIframeHeight){
		 
		 return (outerIframeHeight - 70);
	 }
}









	$.fn.dataTable.ext.errMode = 'throw';


function MM_openBrWindow(theURL,winName,features) { //v2.0
  return window.open(theURL,winName,features);
}

</script>


<!-- Page Rating JS -->
<script>
	
	function browserSupportsCors() {
	    if ("withCredentials" in new XMLHttpRequest()) return true;
	    else if (typeof XDomainRequest == "object") return true;
	    else return false;
	}

	$(document).ready(function(){
		var $star_rating = $('.star-rating .fa');

		var SetRatingStar = function() {
		  return $star_rating.each(function() {
			if (parseInt($star_rating.siblings('input.rating-value').val()) >= parseInt($(this).data('rating'))) {
			  return $(this).removeClass('fa-star-o').addClass('fa-star');
			} else {
			  return $(this).removeClass('fa-star').addClass('fa-star-o');
			}
		  });
		};

		$star_rating.on('click', function() {
		  $star_rating.siblings('input.rating-value').val($(this).data('rating')).change();
		  return SetRatingStar();
		});

		SetRatingStar();
	});
	
	
	// Page Rating 
	$('input[name="pageRating"]').on("change", function(){
		
		var pageRating = $(this).val();
		var documentId = $('#pageCommentsAndRating').find('input[name="documentId"]').val();
		var pageRatingCSRFToken = $('#pageCommentsAndRating').find('input[name="jspCSRFToken"]').val();
			
		var url = "/app/capricorn?para=documentRatingAndComments&type=RATING"; 

		if(browserSupportsCors()) {
			jQuery.ajax({
				type: "POST",
				cache: false,
				url: url,
				data: {
					"pageRating" : pageRating,
					"documentId" : documentId,
					"jspCSRFToken" : pageRatingCSRFToken
				}
			})
			.done(function(data){ 
				
				$('#input-pageRating').val("");

				$('#ratingResponse').html(data);
			});
		} else {
			alert("CORS not supported");
		}
		
	});	
	
	// Page Comments 
	function submitDocumentComments(){
		var documentId = $('#pageCommentsAndRating').find('input[name="documentId"]').val(); 
		var ratingComment = $('#input-pageComment').val();
		var pageRatingCSRFToken = $('#pageCommentsAndRating').find('input[name="jspCSRFToken"]').val();
		
		if(ratingComment === "") return;
		
		var url = "/app/capricorn?para=documentRatingAndComments&type=COMMENT"; 

		if(browserSupportsCors()) {
			jQuery.ajax({
				type: "POST",
				cache: false,
				url: url,
				data: {
					"documentId" : documentId,
					"ratingComment" : ratingComment,
					"jspCSRFToken" : pageRatingCSRFToken
				}
			})
			.done(function(data){ 
				$('#input-pageComment').val("");

				$('#commentsResponse').html(data);
			});
		} else {
			alert("CORS not supported");
		}
		
	}
	
	$('button[name="pageCommentButton"]').on("click", function(){
		submitDocumentComments();
	});		
	
	$("#pageCommentForm").on('submit', function(e){
		e.preventDefault();
		submitDocumentComments();
	});
	
	
	// =========================================================
	// Center modal dialog to the middle of current view.
	// =========================================================
	var iframeId = "";
	var iframeTop = 0;
	if(window.frameElement){
       	iframeId = window.frameElement.id;
       	iframeTop = parent.$("#"+iframeId).offset().top;  // get the iframe top, i.e. the height between 0 and the iframe's top border.
    }
	// A variable that saves the original form data to detect if the form has been changed when submitting the form.
	var $form_original_data = "";
	// reposition the dialog modal based on the screen view.
	/* $(document).on('shown.bs.modal', '#subscribeDialog, #ajaxSelectLinkedAccountsModal, #ajaxViewAddtionalProfileModal', function(e) {
		// cache the element into js.
	   var $currentTarget = $(e.currentTarget); // modal
	   var dialog = $currentTarget.find('.modal-dialog');
	   centerModalWidget(dialog);
       
   	});	 */
   	
   	$(document).on('shown.bs.modal', '.modal:not(#processingDialog)', function(e) {
		// cache the element into js.
	   var $currentTarget = $(e.currentTarget); // modal
	   var dialog = $currentTarget.find('.modal-dialog');
	   
	   
	   resizeModalForView($currentTarget);
	   
	   
	   if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){
		   parent.$('body,html').addClass("modal-open");
	   }else{
		   centerModalWidget(dialog);
	   }
   	});	
   	
   	
   	function resizeModalForView($currentTarget){
 	   var percentageInsideWindow = 0.65; 
   	   var modalObj = $currentTarget.find('.modal-content');
	   var modalCurrentHeight = $(modalObj).height();
   	   var modalNewHeight = parent.window.innerHeight * percentageInsideWindow;
	   if (modalCurrentHeight > modalNewHeight) {
		   //alert("modalCurrentHeight=" + modalCurrentHeight); // leave it for debug.
		   //alert("modalNewHeight=" + modalNewHeight); // leave it for debug.
		   var modalBody = $currentTarget.find('.modal-body');
		   
		   var modalHeaderHeight = $currentTarget.find('.modal-header').height();
		   var modalFooterHeight = $currentTarget.find('.modal-footer').height();
		   var newModalBodyHeight = Math.max(modalNewHeight - modalHeaderHeight - modalFooterHeight, 50);
		   //alert("newModalBodyHeight=" + newModalBodyHeight); // leave it for debug.
		   $(modalBody).height(newModalBodyHeight);
		   $(modalBody).css('overflow-y', 'auto'); 
	   }
   	}
   	
   	
	$(document).on('hide.bs.modal', '.modal:not(#processingDialog)', function(e) {
		if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){
			parent.$('body, html').removeClass("modal-open");
		}
	});
   	
   	
	
    $('#processingDialog').on('show.bs.modal', function(e){  
    	var $currentTarget = $(e.currentTarget); // modal
	   	var dialog = $currentTarget.find('.modal-dialog');
	   	centerModalWidget(dialog, 450); // note: make the height larger such as 450 would put the widget higher instead of center.
    });
  
   	
	
 	// a function to center the passed in dialog/modal in the current view port.
   	function centerModalWidget(dialog, dialogHeight){
        var offset = $(parent.document).scrollTop(); // Get the current vertical position of the scroll bar for the first element in the set of matched elements
        var actualViewportHeight = parent.window.innerHeight;
        // #330-304 - Enhance the centerModal logic by using a more accurate modal height if applicable.
        var modalHeight = 0;

        // #330-370: use the height from the parameter by default. If no height value is passed in, detect the modal height programmatically.
        if(typeof(dialogHeight) !== 'undefined' && dialogHeight!==0){
        	modalHeight = dialogHeight;
        }else{
        	modalHeight = dialog.height();
        }
        
     	// If the modalHeight is still 0, then use an average height value.
        if(modalHeight == 0)
        	modalHeight = 495;  
        
     	// show the modal at the position of (parent.scrollTop - iframe's top) [inner viewport start point] + (actualViewportHeight-modalHeight)/2) [center in the current view port] .
        var newPosition = 0;
     	var innerFrameTop = 0;
        if(window.frameElement){ // if this is inside a iframe, then calculate the distance between iframeTop and scrollTop. If not a iframe, then always use 0.
        	// #330-337 - When the view port is staying at the top of the iframe, this value should allow to be negative.The negative iframeTop value should be included in the calculation for centering. 
        	//innerFrameTop = Math.max(0, offset-iframeTop);
        	innerFrameTop = offset-iframeTop;
        	// #330-337 - the final new position must be either postive value or 0. 
        	newPosition = Math.max(0, innerFrameTop + (actualViewportHeight-modalHeight)/2);
        }else{
        	innerFrameTop = offset;
        	newPosition = Math.max(0, innerFrameTop);
        }
     	
        
        
        /* 
        console.log("innerFrameTop=" + innerFrameTop);
        console.log("actualViewportHeight=" + actualViewportHeight);
        console.log("modalHeight=" + modalHeight);
        console.log("scrollTop=" + offset);
        console.log("iframeTop=" + iframeTop);
        console.log("innerFrameTop=scrollTop-iframeTop= " + innerFrameTop);
        console.log("newPosition = innerFrameTop + (actualViewportHeight-modalHeight)/2 = " + newPosition);
        */
        dialog.css("top", newPosition);
        
/*  	   if(innerFrameTop>0){ // if the viewport is showing deep down in the parent window, i.e. innerFrameTop will be greater than 0. Show the dialog in the center of innerFrameTop.
        	dialog.css("top", newPosition);
 	   } else{ // if the viewport is showing the top of the parent window, i.e. innerFrameTop will be 0. Show the dialog closed to the top of inner frame.
 		    dialog.css("top", "20%");
 	   } */
   	} 

 	
   	$(document).on('click', ".btnClickLoading", function(e){
   		var $thisButton = $(this);
   		if($thisButton.attr("data-loading-text") === ""){ // add the default loading message if not set.
   			$thisButton.attr("data-loading-text", "Loading...");
   		}
   		$thisButton.button('loading');
   	});
   	
   	
   	var iframeId = "";
	if(window.frameElement){
       	iframeId = window.frameElement.id;
    }
   	
   	Highcharts.setOptions({
    	
	    	lang: {
	            decimalPoint: '.',
	            thousandsSep: ','
	        }
    	
    });
 	
</script>






<!-- Script to Activate the Carousel -->
<script type="text/javascript">
$('.carousel').carousel({
	interval: 5000 //changes the speed
})
</script>

<script type="text/javascript">
	
	
	// +---------------------------------------------------------------------
	// | Auto Refresh: 330-263 
	// +---------------------------------------------------------------------
	var itimer;
	var timeInterval;
	
	function set_interval() { 
		var timeoutMins = 1000 * 1 * 300; 
		itimer=setTimeout("auto_reload()",timeoutMins);
	}
	
	function auto_reload() {
	  location.replace('/app/login.jsp');
	}
	// +---------------------------------------------------------------------
		
	
	function initFields() {
	   	var form = document.login;
		form.accessCode.focus();
		form.accessCode.select();
		
		set_interval();
		
	}
	
	function processRememberMyAccountNumber() {
	  // if rememberMyAccountNumber flag is check, then write the account# to the PowerStream cookie
	  if (document.login.rememberMyAccountNumber.checked == true) {
	    write_cookie('Y');
	  } else {
	    write_cookie('N');
	  }
	  
	}
	
	cookie_name = "www.emwd.org_admin";
	function write_cookie(writeAcctFlag)	{
	  if (document.cookie) {
	    index = document.cookie.indexOf(cookie_name);
	  } else {
	    index = -1;
	  }
	  if (index == -1) { // cookie not found
	    if (writeAcctFlag == "Y") {
	   	  // #330-068 : @jli 2018-02-16 - encode the access code value before putting it into cookie  
	      document.cookie = cookie_name + "=" + encodeURI(document.login.accessCode.value) + "; expires=Wednesday, 01-Aug-2040 08:00:00 GMT";
	    }
	  } else { // cookie found
	    if (writeAcctFlag == "Y") {
	      // #330-068 : @jli 2018-02-16 - encode the access code value before putting it into cookie.
	      document.cookie = cookie_name + "=" + encodeURI(document.login.accessCode.value) + "; expires=Wednesday, 01-Aug-2040 08:00:00 GMT";
	    } else {
	      document.cookie = cookie_name + "=NA";
	    }
	  }
	}
	
	function getAccountNo()	{
	  if (document.cookie) {
	    index = document.cookie.indexOf(cookie_name);
	    if (index != -1) { // cookie for powerstream found
	      countbegin = (document.cookie.indexOf("=", index) + 1);
	      countend = document.cookie.indexOf(";", index);
	      if (countend == -1) {
	        countend = document.cookie.length;
	      }
	      accountNo = document.cookie.substring(countbegin, countend);
	      if (accountNo == "NA") {
	        accountNo = "";
	        document.login.rememberMyAccountNumber.checked = false;
	      } else {
	        document.login.rememberMyAccountNumber.checked = true;
	      }
	      // #330-068 : @jli 2018-02-16 - decode the access code value when retrieving it from cookie.  
	      document.login.accessCode.value = decodeURI(accountNo);
	      if (document.login.accessCode.value != "") {
	        document.login.password.focus();
	      }
	    } else { // cookie for powerstream not found
	      document.login.rememberMyAccountNumber.checked = false;
	    }
	  }
	}
	
	jQuery(function ($) {
		
	    $('#login-form').validate({
		    rules: {
		    	 accessCode: {
			        required: true
			     },
				 password: {
					required: true
				 }
		    },
	        highlight: function(element) {
	            $(element).closest('.form-group').addClass('has-error');
	        },
	        unhighlight: function(element) {
	            $(element).closest('.form-group').removeClass('has-error');
	        },
	        errorElement: 'span',
	        errorClass: 'help-block',
	        errorPlacement: function(error, element) {
	            if(element.parent('.input-group').length) {
	                error.insertAfter(element.parent());
	            } else {
	                error.insertAfter(element);
	            }
	        },
	        submitHandler: function(form) {
	    	   $("#processingDialog .progress-bar").html("<strong>Please wait a few seconds while we verify your login information...</strong>");
	    	   $("#processingDialog").modal('show');
	    	   processRememberMyAccountNumber();
	    	   form.submit();
	        }
	    }); 
	    
	    
	    
	    
	    
	    
    });

</script>



<script type="text/javascript">
	
	$(".toggle-password").click(function() {
		$(this).children("i").toggleClass(".fa-eye fa-eye-slash");
		var pwdInput = $($(this).attr("toggle"));
		if (pwdInput.attr("type") === "text") {
			pwdInput.attr("type", "password");
		} else {
			pwdInput.attr("type", "text");
		}
	});
	
	
	$(document).on('click', "#pickVerificationMethod a", function(e){
		e.preventDefault();
		var $verifiMethodCode = $(this).data("verifimethod");
		var $verifiMethodLabel = $(this).text();
		$("#btnLabel-pickVerifiMethod").text($verifiMethodLabel);
		
		var $selectedVerifiMethodCode = $('#id-selectedVerifiMethod');
		$selectedVerifiMethodCode.val($verifiMethodCode);
		$selectedVerifiMethodCode.valid();
	});
	
	jQuery(function($){
		
		if($("#btnLabel-pickVerifiMethod").length){
			var $btnPickVerifiMethod = $("#btnLabel-pickVerifiMethod");
			var $btnPickVerifiMethodLabel = $btnPickVerifiMethod.text().trim();
			if($btnPickVerifiMethodLabel === ""){
				var $verifiMethodCode = $btnPickVerifiMethod.data("verifimethod");
				var $firstVerifiMethodOption = $("#pickVerificationMethod li:first-child>a");
				var $firstVerifiMethodOptionLabel = $firstVerifiMethodOption.text();
				var $firstVerifiMethodOptionCode = $firstVerifiMethodOption.data("verifimethod");
				$("#btnLabel-pickVerifiMethod").text($firstVerifiMethodOptionLabel);
				
				var $selectedVerifiMethodCode = $('#id-selectedVerifiMethod');
				$selectedVerifiMethodCode.val($firstVerifiMethodOptionCode);
			}
		}
	});
	
</script> 
</body>
</html>

