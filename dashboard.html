





<!DOCTYPE html>
<html lang="en">
<head>
	<!-- 05/12/2017 - Security Patch -->
	<meta name="robots" content="noindex,nofollow" />
	<meta name="Cache-Control" content="private" />
	<meta name="X-Robots-Tag" content="noindex" />					  

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<title>EMWD :: Water Usage Information</title>
	
			


<meta name="description" content="EMWD is your power hub for customer self service web portals supplying electrical energy to residential, commercial and industrial customers.">
<meta name="keywords" content="EMWD, MyAccount, deregulation, heating, energy, power, utility, appliance, range, stove, dryer, water heater, air conditioning, fireplace, home improvement, renovation, electricity, electric power, electric energy, electric generation, electric meter, customer service, electric bill, residential electric rates, business electric rates, energy audit, kilowatt, kilowatt hour, kWh, bill payment information, electrical usage rates, rates, bill payment information, electrical information, electricity information, electrical services">
	



	
	
	
	<script src="/PortalV4.0/js/jquery.min.js"></script>
	


	<link href="/PortalV4.0/css/cap.min.css" rel="stylesheet" type="text/css">
	
    

	<link href="/PortalV4.0/capricornCustom.css" rel="stylesheet" type="text/css">
	<link rel="shortcut icon" href="/PortalV4.0/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">

</head>

<body class="tabContentWrapper">






<!-- This is the processing dialog (loading bar) -->
<div class="modal fade" id="processingDialog" tabindex="-1" role="dialog" 
    aria-labelledby="processingDialog" aria-hidden="true" data-keyboard="false" data-backdrop="static">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="text-center">
				<div class="progress progress-striped active" style="height: 40px; margin-bottom: 0px;">
					<div class="progress-bar progress-bar-primary" style="width: 100%; height: 40px; line-height: 40px; font-size: 14px;">
						<strong>Loading...</strong>
					</div>
				</div>
			</div>
		</div>
	</div>
</div> 


</div>

<div class="panel panel-capricorn">
	<div class="panel-body">
		
			
		
		<div style="margin-bottom: 20px;">
			




<!-- This is the processing dialog (loading bar) for smart meter pages which include this radio button jsp -->
	<div class="modal fade" id="processingDialog" tabindex="-1" role="dialog" 
			aria-labelledby="processingDialog" aria-hidden="true" data-keyboard="false" data-backdrop="static">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="text-center">
				<div class="progress progress-striped active" style="height: 40px; margin-bottom: 0px;">
					<div id="processingBarLabel" class="progress-bar progress-bar-primary" style="width: 100%; height: 40px; line-height: 40px; font-size: 14px;">
						<strong>Loading...</strong>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>





<div id="subtabs" class="btn-group hidden-xs" data-toggle="buttons">

    <label id="subTabs-button-WATSMCON" class="btn btn-default btn-lg active ">   
    	<input type="radio" id="subTabs-WATSMCON" name="subTabs-WATSMCON" checked 
    			data-optcde="WATSMCON"  data-opttar="" autocomplete="off" 
    			aria-hidden="true" 
    			rel="/app/capricorn?para=smartMeterConsum&inquiryType=water&tab=WATSMCON&deviceLandingPage=WATSMCON" />
    	<i class="fa fa-tint"></i> Water
    </label>

    <label id="subTabs-button-WATBUDFCV2" class="btn btn-default btn-lg  ">   
    	<input type="radio" id="subTabs-WATBUDFCV2" name="subTabs-WATBUDFCV2"  
    			data-optcde="WATBUDFCV2"  data-opttar="" autocomplete="off" 
    			aria-hidden="true" 
    			rel="/app/capricorn?para=waterBudgetForecastV2&menuKey=WATSMCON&tab=WATBUDFCV2&deviceLandingPage=WATBUDFCV2" />
    	<i class="fa fa-area-chart" aria-hidden="true"></i> Water Budget
    </label>

</div>


<div id="xs-subtabs" class="btn-group-vertical visible-xs" data-toggle="buttons">

    <label id="xs-subTabs-button-WATSMCON" class="btn btn-default btn-lg active ">   
    	<input type="radio" id="xs-subTabs-WATSMCON" name="xs-subTabs-WATSMCON"  checked 
    			data-opttar=""  autocomplete="off" 
    			rel="/app/capricorn?para=smartMeterConsum&inquiryType=water&tab=WATSMCON&deviceLandingPage=WATSMCON" />
    	<i class="fa fa-tint"></i> Water
    </label>

    <label id="xs-subTabs-button-WATBUDFCV2" class="btn btn-default btn-lg  ">   
    	<input type="radio" id="xs-subTabs-WATBUDFCV2" name="xs-subTabs-WATBUDFCV2"   
    			data-opttar=""  autocomplete="off" 
    			rel="/app/capricorn?para=waterBudgetForecastV2&menuKey=WATSMCON&tab=WATBUDFCV2&deviceLandingPage=WATBUDFCV2" />
    	<i class="fa fa-area-chart" aria-hidden="true"></i> Water Budget
    </label>

</div>

<script>
$(function () {
	$('[data-toggle="nav-popover"]').popover()
})
</script>



		</div>
		
	
			

		
			<h4>Water Usage Information</h4>
			
		
     
        
        

		  
		  	<form name="hydroInquiry" method="post" action="/app/index.jsp">
				<input type="hidden" name="para"/>
			  	<input type="hidden" name="downloadConsumption"/>
			  	<input type="hidden" name="userAction"/>
			  	<input type="hidden" name="type"/>
			  	<input type="hidden" name="inquiryType"/>
			  	<input type="hidden" name="day"/>
			  	<input type="hidden" name="fromDate" value="2025-07-06" />
			  	<input type="hidden" name="toDate" value="2025-08-04" />
			  	<input type="hidden" name="tab" value="WATSMCON"> 
			  	
			    	<input type="hidden" name="print" value="N" />
			  	
		        
		  		<!-- First Row of Buttons -->
		  		<div class="text-center panel-body container-fluid">
					<div class="row">
				   	    	  
							  
							  		<div class="col-sm-4">
							  			<button class="multilineBtn btn btn-default btn-block verticalBtn active" type="button" id="dailyConsumptionUageChart" name="dailyConsumptionUageChart">
								  			<i class="fa fa-calendar-o" aria-hidden="true"></i> Daily Usage
								  		</button>
								  	</div>
								  	
									  		
								  			  
							  
							  
							  
								  
								  		<div class="col-sm-4">
								  			<button type="button" class="multilineBtn btn btn-default btn-block verticalBtn" id="hourlyUsage" name="hourlyUsage" onClick="processRequest('hourlyUsage')">
								  				<i class="fa fa-clock-o" aria-hidden="true"></i> Hourly Usage
								  			</button>
								  		</div>
								  
							  
					   
					   
					   
				       
			    	</div> <!-- ./row -->
				</div>
			    <!-- END First Row of Buttons -->
			   
			   
			   
			   
			   <!-- Second Row of buttons -->
			   <!-- Date Pickers -->
			   
					<div class="well container-fluid">
					 
					 
					 
							<input type="hidden" name="selectedMeterId" id="selectedMeterId" class="form-control" value="400027755">
					  
					  
					  
						 	<input type="hidden" name="selectedRegisterNumber" id="selectedRegister"/>
					  
					  <div class="row">
					    <div class="col-sm-4">
					    	<div class="form-group">
								<label for="TOU_fromDate">From Date:</label>
							  	<div class='input-group date' id="TOU_fromDate_picker">
							  		<input type="text" class="form-control" name="TOU_fromDate" id="TOU_fromDate"/>
									<span class="input-group-addon">
										<span class="glyphicon glyphicon-calendar"></span>
									</span>
								</div>
							  	<input type="hidden" id="month_from" name="month_from" />
							    <input type="hidden" id="day_from" name="day_from" />
							    <input type="hidden" id="year_from" name="year_from" /> 
					    	</div> <!-- ./form-group -->					    
					    </div>
					    <div class="col-sm-4">					  
					    	<div class="form-group">
							  	<label for="TOU_toDate">To Date:</label>
							  	<div class='input-group date' id="TOU_toDate_picker">
							  		<input type="text" class="form-control" name="TOU_toDate" id="TOU_toDate"/>
									<span class="input-group-addon">
										<span class="glyphicon glyphicon-calendar"></span>
									</span>
								</div>
							    <input type="hidden" id="month_to" name="month_to" />
							    <input type="hidden" id="day_to" name="day_to" />
							    <input type="hidden" id="year_to" name="year_to" />
							</div> <!-- ./form-group -->
					    </div>
					    <div class="col-sm-4">
					      <label class="hidden-xs">&nbsp;</label>
					      <div class="input-group">
							
							   	<button class="btn btn-default" type="button" id="refresh" name="refresh" onclick="processRequest('refreshChart');"><i class="fa fa-refresh"></i> Refresh Chart</button>
							
						  </div>
					    </div>
					  </div><!-- ./row -->					  
	

					</div> <!-- ./well -->
			   
			   <!-- END Second Row of buttons -->
			 
			 </form>
		  
		  

        
           



		
  	  	
 	  	
 	  	
     		<div id="customEventWidget"></div>
     	

 		
		
            
	        
	        
			<div class="panel panel-default">
				<div id="chart_container" class="notranslate"></div>
				
					<div class="chartTipsContainer text-center">
						<img src="/app/icons/16x16/BulbOn.png" role="presentation"/>DID YOU KNOW: You can turn chart features on and off by clicking the labels in the legend above. You can zoom in the chart by clicking and dragging inside the chart area.
					</div>
				 
				
				<!-- previous, next buttons -->
				
				<!-- END previous, next buttons -->
			</div>
			
         	
         	
         			
		

			<!-- TOU Summary section only for Electric inquiry type -->
		    
		  
			
			
			
          
          
          
          
          	<div class="alert alert-info pageIntroContainer">
          		<p><p>Use the bar graph functions in this interactive water usage chart to assist you in understanding and managing your consumption patterns. The consumption data displayed here is the most current available, but will not be finalized until the billing date.</p><p>The Daily Usage Chart allows you to select and view up to ninety days of data at one time, the Hourly Usage Chart displays hourly consumption for a single day selected by you. Please note: the current date is outside the range of recorded values.</p><p>Water usage will display in chart if all validation parameters are passed. Billing period data is validated prior to release of bill.</p><hr><div class="container"> <div class="row"> <div class="col-sm-6"> <p>EMWD meters measure water use in cubic feet and acre feet. All residential customers have meters that measure cubic feet. Non-residential customers may have meters that measure cubic feet as well as landscape meters that measure in acre feet.</p><p><strong>For Residential Customers:</strong> <br>EMWD converts cubic feet (CF) into billing units for your monthly billing statement. <br>1 CF=7.48 gallons <br>1 billing unit (BU)=100 CF or 748 gallons</p><p><strong>For Non-residential Customers:</strong> <br>Please note: Accounts not billed in billing units are billed in acre feet.</p><p></p></div><div class="col-sm-6"> <img width='101.5%'src='/capWSSUEv3.3.0/images/Pitcher- Sink- Pool - Gallons to Cubic Feet.png'> </div></div></div></p>
          	</div>
          

		
		
          
          
			



<div class="container-fluid pageCommentsAndRating" id="pageCommentsAndRating">
	<hr />
	<div class="row">
		<div><input id="documentId" name="documentId" type="hidden" value="SMCONSUM" /></div>
		
		
		
		<div class="col-sm-8">
			<form id="pageCommentForm">
				<div class="input-group">
					<div class="input-group-addon">
						<span class="glyphicon glyphicon-comment"></span>
					</div>
					<input class="form-control" id="input-pageComment" maxlength='1024' title="Rating Comment" name="ratingComment" placeholder="We welcome your comments and feedback" type="text" /> 
					<span class="input-group-btn">
						<button class="btn btn-default" id="pageCommentButton" name="pageCommentButton" type="button" aria-labelledby="input-pageComment">
							<span class="glyphicon glyphicon-ok"></span> 
						</button> 
					</span>
				</div>
				
				<!-- /input-group -->
				<div id="commentsResponse"></div>
				<input type="hidden" name="jspCSRFToken" value="3c67b320a388a9b6194c6e0533c2678e64b0d210" />
			</form>
		</div>
		
		<div class="col-sm-4">
			<div class="star-rating"><span class="star-rating-label  ">Rate this page</span> 
				<span class="fa fa-star-o" data-rating="1"></span> 
				<span class="fa fa-star-o" data-rating="2"></span> 
				<span class="fa fa-star-o" data-rating="3"></span> 
				<span class="fa fa-star-o" data-rating="4"></span> 
				<span class="fa fa-star-o" data-rating="5"></span> 
				<input class="rating-value" id="input-pageRating" name="pageRating" type="hidden" />
			</div>
			<div class="text-right" id="ratingResponse"></div>
		</div>
		
		
	</div> <!-- ./row -->
</div> <!-- ./Page Comments & Rating -->



		  
          
	</div>
	<!-- ./panel-body -->
</div> 
<!-- END panel  -->

















	<script src="/PortalV4.0/js/cap.min.js" type="text/javascript"></script>
	




<script src="/PortalV4.0/js/custom.js" type="text/javascript"></script>

<script type="text/javascript">


//change the moment locale globally based on the language code.
moment.locale('en');


function showProcessingDialog(processingBarLabel) {
	if(processingBarLabel != null && processingBarLabel !== ''){
		$("#processingBarLabel").html(processingBarLabel);
	}
	$("#processingDialog").modal('show');
}

function hideProcessingDialog(){
	$("#processingDialog").modal('hide');
}

$(document).ready(function() {
	var secureFlag = true;

	/* Close the scotch panel (left-menu) while clicking on iframe contents. */
	$('body, .tabContentWrapper').on('click', function(e){
		if(window.parent.dashboardScotchPanel !== undefined){			
			window.parent.dashboardScotchPanel.close();
		}
	});

	
	
	$("head").append("<link href='//fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>");
	
	
    
    
	
	// =========================================
    
	// JS codes for topIncludeV3.jsp
	//$("#subtabs, #xs-subtabs").buttonset();
	
	$("#subtabs input[type=radio], #xs-subtabs input[type=radio]").change(function() {
	    // 330-694 Kubra changes for EMWD support generic landing page and open page in new window instead of iframe via opttar
	    // CAP-833: Modified logic for subMenu(TopNavigationMenu) to support the optionTarget value and behave accordingly.
	    // Possible targetOption values are: _top, _parent, _blank, and any custom value.
	    // _top and _parent would open the response in the same tab.
	    // _blank and custom target value would open the response in the new tab.
		var optionTarget = $(this).attr("data-opttar");
		if ('_parent' === optionTarget ) { // same tab
			window.parent.location.href = $(this).attr("rel") + '&opttar='+optionTarget;
			return false;
	
		} else if ('_top' === optionTarget ) { // same tab
			window.top.location.href = $(this).attr("rel") + '&opttar='+optionTarget;
			return false;
		
		} else if (('_blank' === optionTarget) || ('' != optionTarget) ) { // new tab for _blank target or any other customized target
			window.open($(this).attr("rel") + '&opttar='+optionTarget, optionTarget) ;
			var _this = this;
			setTimeout(function() { $(_this).parent().removeClass('active') ;}); // trick to deselect the radio
			
		} else {
			showProcessingDialog();
			window.location.href = $(this).attr("rel");			
		}
		
	});
	// END JS codes for topIncludeV3.jsp
	// =========================================
    
   $('#SMCONSUM').click(function() {
     	showProcessingDialog();
   });
   $('#SMARTCON').click(function() {
     	showProcessingDialog();
   });
   
   $('a[rel*=blockUI]').click(function() {
    	showProcessingDialog();
   });


	// Setup jQuery button styling
	$( "input:submit, input:button, a, button", ".buttonV2" ).button();
	$( "a", ".buttonV2" ).click(function() { return false; });

	// Setup shadows
	$('.box.standard').shadow();
	$('.box.lifted').shadow('lifted');
	$('.box.perspective').shadow('perspective');
	$('.box.raised').shadow('raised');
	$('.box.sides-vt-1').shadow({type:'sides',sides:'vt-1'});
	$('.box.sides-vt-2').shadow({type:'sides',sides:'vt-2'});
	$('.box.sides-hz-1').shadow({type:'sides',sides:'hz-1'});
	$('.box.sides-hz-2').shadow({type:'sides',sides:'hz-2'});
	$('.box.rotated').shadow({type:'rotated',rotate:'-5deg'});	

	// Help text dialog
    $(".helpLink").click(function () {
        $("#helpDialog").attr('src', $(this).attr("href"));
        $("#helpDiv").dialog({
            width: 640,
            height: 450,
            modal: true,
            close: function () {
                $("#helpDialog").attr('src', "about:blank");
            }
        });
        return false;
    }); 
    
    // change number: 252-013
	var f=navigator.userAgent.search("Firefox");
	var c=navigator.userAgent.search("Chrome");
	var ie=navigator.userAgent.search("MSIE") + (navigator.userAgent.search(/Trident/)); // MSIE for older ie and Trident for newer IE such as IE 11
	var ie9=navigator.userAgent.search("MSIE 9.0");
    
    // set the zoom level from cookie
    var cookie_name = "zoom_level";
    var index = document.cookie.indexOf(cookie_name);
    var zoomlvl = 100;
    
	// change number: 252-013
	// write cookies
	function write_cookie_for_zoom(zoomLevel)	{
		$.cookie(cookie_name, zoomLevel,  { path: '/', expires: 3650, secure: secureFlag });
	}
    
    if (index >= 0) {
    	zoomlvl = Number(document.cookie.substring(index).split(";")[0].split("=")[1]);
    	 
    	if(zoomlvl!=100){
    		zoom(zoomlvl);
    	}

    }else{
   		/*console.log("Cookie not Found at the beginning.");*/
    }
 
   // zoom in the page
   $("#zoom_in_page").click(function () {
        // max zoom level is 150%
        if(zoomlvl>= 150){
          return;
        }
        zoomlvl += 10;
        zoom(zoomlvl);
   });
   
   // zoom out the page
   $("#zoom_out_page").click(function () {
   		// min zoom level is 70%
        if(zoomlvl<=70){
          return;
        }
    	zoomlvl -= 10;
    	zoom(zoomlvl);
   });
   
   // zoom back
   $("#back_to_original_page").click(function () {
    	zoomlvl = 100;
    	zoom(zoomlvl);
   });
   

   function zoom(zoomlvl){
	   	if(f>-1){ // for firefox, use css3: transform:scale
	        $("body").css({
	      			"-moz-transform": "scale(" + zoomlvl/100 + ")",
	     			"-moz-transform-origin": "0 0"
	   		});
	        var viewPortWidth = $(window).width();
	   		var currMainContentWrapperWidth = viewPortWidth * (zoomlvl/100);
	   		var mainContentWidthDiff = (currMainContentWrapperWidth - viewPortWidth) / 2;
			if(mainContentWidthDiff>50){ /* zoom in */
		   		$("body").css("left", "-" + mainContentWidthDiff + "px");
			}else if(mainContentWidthDiff<50){  /* zoom out */
		   		$("body").css("left", mainContentWidthDiff + "px");
			}
	   		
	    }else if(ie9>-1){ // for ie9
	    	$("body").css({
	 			"transform": "scale(" + zoomlvl/100 + ")",
				"transform-origin": "0 0",
				"-ms-transform": "scale(" + zoomlvl/100 + ")",
				"-ms-transform-origin": "0 0"
			});
	    
	    }else{  // for other browers, use zooming
	   	  $("body").css("zoom", zoomlvl+"%");
	  	  if(ie>-1){  // for ie, re-position the div to center
	  		 $("body").css("width", "100%");
	  	  	
	  	     // center the viewport in the center if there is scroll bar in the window.
	  	     var newPosition =  ($(document).width() - $(window).width())/2;
	  	   	 window.scrollTo(newPosition,0);
	      }
	   	}
	   	write_cookie_for_zoom(zoomlvl);
   }
   
   
   
		$(".btnSwitchLanguage").on('click', function(e){
			var ajaxUrl = "/app/capricorn?para=switchLanguage";
			
			var language = "ES";
			$.ajax({
				type: "post",
			    cache: false,
				url: ajaxUrl,
				data: {
					"language" : language
				}
			}).done(function(){
				// cookie will expire in 10 years...
				$.cookie("emwd.org_language", language,  { expires: 3650, secure: secureFlag });
				
				if(window.location.href.indexOf('/capricorn') > -1){
					window.location.replace("/app");
				}else{
					window.location.reload();
				}
				
			});
			
		});	

 
   
  
  
  
  
  function onElementHeightChange(elm, callback){
		
		if(elm == null)
			return;
		var index = 0;
		var lastHeight = elm.clientHeight, newHeight;
	    (function run(){
	        newHeight = elm.clientHeight;
	        
	        
	        if( lastHeight != newHeight || (lastHeight == newHeight && !iframeHeightAdjusted))
	            callback();
	        lastHeight = newHeight;

	        if( elm.onElementHeightChangeTimer )
	            clearTimeout(elm.onElementHeightChangeTimer);

	        //console.log('run' + (index++));
	        elm.onElementHeightChangeTimer = setTimeout(run, 500);
	    })();
	    
	    // #330-300 - 2018-11-15 : Enhance the performance by reducing the workload. Cancel the resize function in 10 seconds.
	    
	    if( elm.onElementHeightChangeTimer ){
	    	setTimeout( function(){
	    		clearTimeout(elm.onElementHeightChangeTimer);
	    		//console.log('clear timeout');
	    	}, 5000);
	    }
	}
  
  onElementHeightChange(document.body, function(){
		resizeIFrameWhenBodyHeightChanges();
	  });  	
  	//setTimeout(resizeIFrameWhenBodyHeightChanges, 2000);
   
	
	$(document).on('click', ".logoff", function(e){
	 	e.preventDefault();
	 	$("#form-logoff").submit();
	});
  	
}); /* end jQuery.document.ready() */




var iframeHeightAdjusted = (typeof $.cookie("googtrans") == 'undefined' || $.cookie("googtrans") === "/en/en");


// 2017-06-06 @hli: Resize current active iframe according to its own content height when the page finishes loading.
// 2017-08-14 @grohman: Account for new dashboard nav.
function resizeIFrameWhenBodyHeightChanges(){
	  var $frametabs = parent.$('.iframetab');
	  var currentFrame;
	  $frametabs.each(function(){ 
		  var $iframeTabContainer = $(this).closest(".tab-pane");
		  if($iframeTabContainer.css("display") != "none"){ // all other iframes are invisible. Find the current active iframe.
			  currentFrame = $(this);
			  currentFrame.load(resizeIframe()); // reload the current iframe size.
			  return;
		  }
	  });
	  
	  // reload iframe according to the content size.
	  function resizeIframe() {
	  	  var frameBodyElment = currentFrame.contents().find("body")[0];
	  	  if(frameBodyElment == undefined){
	  		  return;
	  	  }
		  var contentHeight = frameBodyElment.offsetHeight;
		  
		  var myScotchNav = parent.document.getElementById('myAccountTabs');
		  if(typeof myScotchNav !== 'undefined'){
			  if(contentHeight < myScotchNav.offsetHeight){
				  contentHeight = myScotchNav.offsetHeight;
			  }
		  }
		  
		  
		  
		  if(!iframeHeightAdjusted){
		  	 currentFrame.height(contentHeight+1);
		  	 iframeHeightAdjusted = true;
		  }
				  
		  // CAP-997 V4 - Default height of Iframes
		  // Get the iframe padding height from menu option code and para from above java code.  
		  // Compare it with contentHeight and take the larger one to set the default page height.
		  var iframePaddingHeight = 0;
		  var maxHeight = contentHeight;
		  if(iframePaddingHeight > contentHeight) {
			  maxHeight = iframePaddingHeight;
	      
			  resizeInnerIframe(maxHeight); 
		  }
		  
		  currentFrame.height(maxHeight + 1);
		  
	  }
	  
	  
	  function resizeInnerIframe(outerIframeHeight){
	  	  var innerFrame = $(".heightAdjustedInnerIframe");
		  if(innerFrame[0]){
			  innerFrame[0].height = calculateHeightInnerIframe(outerIframeHeight);
		  }
	  }
	  
	  
	  function calculateHeightInnerIframe(outerIframeHeight){
		  var subtabs = $("#subtabs");
		  var subtabsVertical = $("#xs-subtabs");
		  if(subtabs[0] || subtabsVertical[0]){
			  return calculateHeightWithSubTabs(subtabs, subtabsVertical, outerIframeHeight);
		  } else{
			  return calculateHeightWithoutSubTabs(outerIframeHeight);
		  }
	  }
	  
	 function calculateHeightWithSubTabs(subtabs, subtabsVertical, outerIframeHeight){
		  var subtabsHeight = subtabs[0].offsetHeight;
		  var subtabsVerticalHeight = subtabsVertical[0].offsetHeight;
		  var innerHeight = outerIframeHeight;
		  
		  
		  if(subtabsHeight != 0){
			  innerHeight -= (subtabsHeight + 70);
		  } else if(subtabsVerticalHeight != 0){
			  innerHeight -= (subtabsVerticalHeight + 70);
		  }
		  
		  return innerHeight;
	 }
	 
	 function calculateHeightWithoutSubTabs(outerIframeHeight){
		 
		 return (outerIframeHeight - 70);
	 }
}









	$.fn.dataTable.ext.errMode = 'throw';


function MM_openBrWindow(theURL,winName,features) { //v2.0
  return window.open(theURL,winName,features);
}

</script>


<!-- Page Rating JS -->
<script>
	
	function browserSupportsCors() {
	    if ("withCredentials" in new XMLHttpRequest()) return true;
	    else if (typeof XDomainRequest == "object") return true;
	    else return false;
	}

	$(document).ready(function(){
		var $star_rating = $('.star-rating .fa');

		var SetRatingStar = function() {
		  return $star_rating.each(function() {
			if (parseInt($star_rating.siblings('input.rating-value').val()) >= parseInt($(this).data('rating'))) {
			  return $(this).removeClass('fa-star-o').addClass('fa-star');
			} else {
			  return $(this).removeClass('fa-star').addClass('fa-star-o');
			}
		  });
		};

		$star_rating.on('click', function() {
		  $star_rating.siblings('input.rating-value').val($(this).data('rating')).change();
		  return SetRatingStar();
		});

		SetRatingStar();
	});
	
	
	// Page Rating 
	$('input[name="pageRating"]').on("change", function(){
		
		var pageRating = $(this).val();
		var documentId = $('#pageCommentsAndRating').find('input[name="documentId"]').val();
		var pageRatingCSRFToken = $('#pageCommentsAndRating').find('input[name="jspCSRFToken"]').val();
			
		var url = "/app/capricorn?para=documentRatingAndComments&type=RATING"; 

		if(browserSupportsCors()) {
			jQuery.ajax({
				type: "POST",
				cache: false,
				url: url,
				data: {
					"pageRating" : pageRating,
					"documentId" : documentId,
					"jspCSRFToken" : pageRatingCSRFToken
				}
			})
			.done(function(data){ 
				
				$('#input-pageRating').val("");

				$('#ratingResponse').html(data);
			});
		} else {
			alert("CORS not supported");
		}
		
	});	
	
	// Page Comments 
	function submitDocumentComments(){
		var documentId = $('#pageCommentsAndRating').find('input[name="documentId"]').val(); 
		var ratingComment = $('#input-pageComment').val();
		var pageRatingCSRFToken = $('#pageCommentsAndRating').find('input[name="jspCSRFToken"]').val();
		
		if(ratingComment === "") return;
		
		var url = "/app/capricorn?para=documentRatingAndComments&type=COMMENT"; 

		if(browserSupportsCors()) {
			jQuery.ajax({
				type: "POST",
				cache: false,
				url: url,
				data: {
					"documentId" : documentId,
					"ratingComment" : ratingComment,
					"jspCSRFToken" : pageRatingCSRFToken
				}
			})
			.done(function(data){ 
				$('#input-pageComment').val("");

				$('#commentsResponse').html(data);
			});
		} else {
			alert("CORS not supported");
		}
		
	}
	
	$('button[name="pageCommentButton"]').on("click", function(){
		submitDocumentComments();
	});		
	
	$("#pageCommentForm").on('submit', function(e){
		e.preventDefault();
		submitDocumentComments();
	});
	
	
	// =========================================================
	// Center modal dialog to the middle of current view.
	// =========================================================
	var iframeId = "";
	var iframeTop = 0;
	if(window.frameElement){
       	iframeId = window.frameElement.id;
       	iframeTop = parent.$("#"+iframeId).offset().top;  // get the iframe top, i.e. the height between 0 and the iframe's top border.
    }
	// A variable that saves the original form data to detect if the form has been changed when submitting the form.
	var $form_original_data = "";
	// reposition the dialog modal based on the screen view.
	/* $(document).on('shown.bs.modal', '#subscribeDialog, #ajaxSelectLinkedAccountsModal, #ajaxViewAddtionalProfileModal', function(e) {
		// cache the element into js.
	   var $currentTarget = $(e.currentTarget); // modal
	   var dialog = $currentTarget.find('.modal-dialog');
	   centerModalWidget(dialog);
       
   	});	 */
   	
   	$(document).on('shown.bs.modal', '.modal:not(#processingDialog)', function(e) {
		// cache the element into js.
	   var $currentTarget = $(e.currentTarget); // modal
	   var dialog = $currentTarget.find('.modal-dialog');
	   
	   
	   resizeModalForView($currentTarget);
	   
	   
	   if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){
		   parent.$('body,html').addClass("modal-open");
	   }else{
		   centerModalWidget(dialog);
	   }
   	});	
   	
   	
   	function resizeModalForView($currentTarget){
 	   var percentageInsideWindow = 0.65; 
   	   var modalObj = $currentTarget.find('.modal-content');
	   var modalCurrentHeight = $(modalObj).height();
   	   var modalNewHeight = parent.window.innerHeight * percentageInsideWindow;
	   if (modalCurrentHeight > modalNewHeight) {
		   //alert("modalCurrentHeight=" + modalCurrentHeight); // leave it for debug.
		   //alert("modalNewHeight=" + modalNewHeight); // leave it for debug.
		   var modalBody = $currentTarget.find('.modal-body');
		   
		   var modalHeaderHeight = $currentTarget.find('.modal-header').height();
		   var modalFooterHeight = $currentTarget.find('.modal-footer').height();
		   var newModalBodyHeight = Math.max(modalNewHeight - modalHeaderHeight - modalFooterHeight, 50);
		   //alert("newModalBodyHeight=" + newModalBodyHeight); // leave it for debug.
		   $(modalBody).height(newModalBodyHeight);
		   $(modalBody).css('overflow-y', 'auto'); 
	   }
   	}
   	
   	
	$(document).on('hide.bs.modal', '.modal:not(#processingDialog)', function(e) {
		if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){
			parent.$('body, html').removeClass("modal-open");
		}
	});
   	
   	
	
    $('#processingDialog').on('show.bs.modal', function(e){  
    	var $currentTarget = $(e.currentTarget); // modal
	   	var dialog = $currentTarget.find('.modal-dialog');
	   	centerModalWidget(dialog, 450); // note: make the height larger such as 450 would put the widget higher instead of center.
    });
  
   	
	
 	// a function to center the passed in dialog/modal in the current view port.
   	function centerModalWidget(dialog, dialogHeight){
        var offset = $(parent.document).scrollTop(); // Get the current vertical position of the scroll bar for the first element in the set of matched elements
        var actualViewportHeight = parent.window.innerHeight;
        // #330-304 - Enhance the centerModal logic by using a more accurate modal height if applicable.
        var modalHeight = 0;

        // #330-370: use the height from the parameter by default. If no height value is passed in, detect the modal height programmatically.
        if(typeof(dialogHeight) !== 'undefined' && dialogHeight!==0){
        	modalHeight = dialogHeight;
        }else{
        	modalHeight = dialog.height();
        }
        
     	// If the modalHeight is still 0, then use an average height value.
        if(modalHeight == 0)
        	modalHeight = 495;  
        
     	// show the modal at the position of (parent.scrollTop - iframe's top) [inner viewport start point] + (actualViewportHeight-modalHeight)/2) [center in the current view port] .
        var newPosition = 0;
     	var innerFrameTop = 0;
        if(window.frameElement){ // if this is inside a iframe, then calculate the distance between iframeTop and scrollTop. If not a iframe, then always use 0.
        	// #330-337 - When the view port is staying at the top of the iframe, this value should allow to be negative.The negative iframeTop value should be included in the calculation for centering. 
        	//innerFrameTop = Math.max(0, offset-iframeTop);
        	innerFrameTop = offset-iframeTop;
        	// #330-337 - the final new position must be either postive value or 0. 
        	newPosition = Math.max(0, innerFrameTop + (actualViewportHeight-modalHeight)/2);
        }else{
        	innerFrameTop = offset;
        	newPosition = Math.max(0, innerFrameTop);
        }
     	
        
        
        /* 
        console.log("innerFrameTop=" + innerFrameTop);
        console.log("actualViewportHeight=" + actualViewportHeight);
        console.log("modalHeight=" + modalHeight);
        console.log("scrollTop=" + offset);
        console.log("iframeTop=" + iframeTop);
        console.log("innerFrameTop=scrollTop-iframeTop= " + innerFrameTop);
        console.log("newPosition = innerFrameTop + (actualViewportHeight-modalHeight)/2 = " + newPosition);
        */
        dialog.css("top", newPosition);
        
/*  	   if(innerFrameTop>0){ // if the viewport is showing deep down in the parent window, i.e. innerFrameTop will be greater than 0. Show the dialog in the center of innerFrameTop.
        	dialog.css("top", newPosition);
 	   } else{ // if the viewport is showing the top of the parent window, i.e. innerFrameTop will be 0. Show the dialog closed to the top of inner frame.
 		    dialog.css("top", "20%");
 	   } */
   	} 

 	
   	$(document).on('click', ".btnClickLoading", function(e){
   		var $thisButton = $(this);
   		if($thisButton.attr("data-loading-text") === ""){ // add the default loading message if not set.
   			$thisButton.attr("data-loading-text", "Loading...");
   		}
   		$thisButton.button('loading');
   	});
   	
   	
   	var iframeId = "";
	if(window.frameElement){
       	iframeId = window.frameElement.id;
    }
   	
   	Highcharts.setOptions({
    	
	    	lang: {
	            decimalPoint: '.',
	            thousandsSep: ','
	        }
    	
    });
 	
</script>






<script type="text/javascript">
<!--
function entInt(field) {
  var result = new String();
  var numbers = "0123456789.";
  var chars = field.value.split(""); // create array 
  for (i = 0; i < chars.length; i++) {
   if (numbers.indexOf(chars[i]) != -1) result += chars[i];
  }
  if (field.value != result) field.value = result;
}



var hourlyOffPeakRate = 0.0;
var hourlyMidPeakRate = 0.0;
var hourlyOnPeakRate = 0.0;

//#330-074
var hourlyGenerationRate = "";
var hourlyDemandRate = "";

// Setup JS arrays for TOU amount on bar chart

var aTouDate = ["2025-07-06","2025-07-07","2025-07-08","2025-07-09","2025-07-10","2025-07-11","2025-07-12","2025-07-13","2025-07-14","2025-07-15","2025-07-16","2025-07-17","2025-07-18","2025-07-19","2025-07-20","2025-07-21","2025-07-22","2025-07-23","2025-07-24","2025-07-25","2025-07-26","2025-07-27","2025-07-28","2025-07-29","2025-07-30","2025-07-31","2025-08-01","2025-08-02","2025-08-03","2025-08-04",];
var aTouOffPeakAmount = ["0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00",];
var aTouMidPeakAmount = ["0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00",];
var aTouOnPeakAmount = ["0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00","0.00",];

// use for optional time block range display on mouse-out bubble on hourly chart
var xLabels = ["12:00 am","1:00 am","2:00 am","3:00 am","4:00 am","5:00 am","6:00 am","7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm","10:00 pm","11:00 pm","12:00 am"];


var xAxisLabelArray = []; 

	
	var labelValues=["12:00 am",'2025-07-06', '2025-07-07', '2025-07-08', '2025-07-09', '2025-07-10', '2025-07-11', '2025-07-12', '2025-07-13', '2025-07-14', '2025-07-15', '2025-07-16', '2025-07-17', '2025-07-18', '2025-07-19', '2025-07-20', '2025-07-21', '2025-07-22', '2025-07-23', '2025-07-24', '2025-07-25', '2025-07-26', '2025-07-27', '2025-07-28', '2025-07-29', '2025-07-30', '2025-07-31', '2025-08-01', '2025-08-02', '2025-08-03', '2025-08-04'];
	for (var i = 1; i < labelValues.length; i++) { 
		var hourStrValue = labelValues[i];
		try {
           var index = labelValues.lastIndexOf(labelValues[i]);
          if (index!=-1)
            	hourStrValue = labelValues[i-1] + " - " + labelValues[i];
          } catch (err){ }
          xAxisLabelArray.push(hourStrValue);
	}




var unitListPerDayOrHour = [ ] ;
var unitList ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '359', onPeak : '0', midPeak : '0', actualReading : '359'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '785', onPeak : '0', midPeak : '0', actualReading : '785'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '239', onPeak : '0', midPeak : '0', actualReading : '239'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '770', onPeak : '0', midPeak : '0', actualReading : '770'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '434', onPeak : '0', midPeak : '0', actualReading : '434'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '352', onPeak : '0', midPeak : '0', actualReading : '352'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '658', onPeak : '0', midPeak : '0', actualReading : '658'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '449', onPeak : '0', midPeak : '0', actualReading : '449'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '254', onPeak : '0', midPeak : '0', actualReading : '254'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '628', onPeak : '0', midPeak : '0', actualReading : '628'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '628', onPeak : '0', midPeak : '0', actualReading : '628'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '314', onPeak : '0', midPeak : '0', actualReading : '314'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '688', onPeak : '0', midPeak : '0', actualReading : '688'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '613', onPeak : '0', midPeak : '0', actualReading : '613'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '703', onPeak : '0', midPeak : '0', actualReading : '703'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '643', onPeak : '0', midPeak : '0', actualReading : '643'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '344', onPeak : '0', midPeak : '0', actualReading : '344'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '359', onPeak : '0', midPeak : '0', actualReading : '359'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '568', onPeak : '0', midPeak : '0', actualReading : '568'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '352', onPeak : '0', midPeak : '0', actualReading : '352'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '479', onPeak : '0', midPeak : '0', actualReading : '479'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '853', onPeak : '0', midPeak : '0', actualReading : '853'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '636', onPeak : '0', midPeak : '0', actualReading : '636'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '456', onPeak : '0', midPeak : '0', actualReading : '456'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '928', onPeak : '0', midPeak : '0', actualReading : '928'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '456', onPeak : '0', midPeak : '0', actualReading : '456'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '277', onPeak : '0', midPeak : '0', actualReading : '277'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '598', onPeak : '0', midPeak : '0', actualReading : '598'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '673', onPeak : '0', midPeak : '0', actualReading : '673'} ); 

		unitListPerDayOrHour.push(unitList) ;
		unitList = [ ] ;

			unitList.push({unit: 'Gal', offPeak: '217', onPeak : '0', midPeak : '0', actualReading : '217'} ); 

		unitListPerDayOrHour.push(unitList) ;

//utility method to return tool tip string for given x series
function getUnitConversionToolTip(x) {	
	var toolTip = '' ;
	if (unitListPerDayOrHour.length > 0 ) {
		var units = unitListPerDayOrHour[x];
		for (var i = 0 ; i < units.length ; i++ ) {
			toolTip += ' <br> ' + units[i].offPeak + ' ' + units[i].unit ;			
		}
	}	
	return toolTip;
}
function getActualReadingConversionToolTip(x) {	
	var toolTip = '' ;
	if (unitListPerDayOrHour.length > 0 ) {
		var units = unitListPerDayOrHour[x];
		for (var i = 0 ; i < units.length ; i++ ) {
			toolTip += ' <br> ' + units[i].actualReading + ' ' + units[i].unit ;			
		}
	}	
	return toolTip;
}

var chart;
$(document).ready(function() {

	chart = new Highcharts.Chart({
		chart: {
			renderTo: 'chart_container',
			plotShadow: true,
			type: 'scatter',
			
			style:{
				fontFamily: '"Helvetica Neue", Helvetica, Arial, sans-serif;'
			},
			
			zoomType: 'x',
			spacingRight: 20,
			// 330-513 Irrigation Control feature controlling the background of the chart depending on if watering is permitted
			
		},
		
	        exporting: {
	            url: 'https://export.highcharts.com'
	        },
	    
		title: {
			text: "Daily Usage Chart",
			style: { font: 'bold 12px "Helvetica Neue", Helvetica, Arial, sans-serif;' }
		},
		subtitle: {
			text: "For the period of July 6, 2025 - August 4, 2025 ",
			style: { font: 'bold 12px "Helvetica Neue", Helvetica, Arial, sans-serif;', color: '#4572A7' }
		},	
		credits: {
            enabled: false
        },
      	legend: {
            itemHiddenStyle: {
                color: '#919191'
            }
        },
		xAxis: {
			
			
			categories: ['2025-07-06', '2025-07-07', '2025-07-08', '2025-07-09', '2025-07-10', '2025-07-11', '2025-07-12', '2025-07-13', '2025-07-14', '2025-07-15', '2025-07-16', '2025-07-17', '2025-07-18', '2025-07-19', '2025-07-20', '2025-07-21', '2025-07-22', '2025-07-23', '2025-07-24', '2025-07-25', '2025-07-26', '2025-07-27', '2025-07-28', '2025-07-29', '2025-07-30', '2025-07-31', '2025-08-01', '2025-08-02', '2025-08-03', '2025-08-04'],
			
			labels: {
			    
				rotation: -70,
				align: 'right',
				
				style: { font: 'normal 10px "Helvetica Neue", Helvetica, Arial, sans-serif;' }
			}
			//,maxZoom: 14, // 14 days
		},
		yAxis: [{
			// Primary yAxis
			labels: {
				formatter: function() {
				    				
					return parseFloat(this.value).toLocaleString('en-US') + ' CF';
					
				},
				style: { color: '#4572A7' }
			},
			title: {
				text: "Water Usage CF",
				style: { color: '#4572A7' }
			},
						
			//min: 0,
			opposite: false
		}
		
		, 
		{ // Secondary yAxis
			labels: {
				formatter: function() {
					return parseFloat(this.value).toLocaleString('en-US');
				},
				style: { color: '#89A54E' }
			},			
			title: {
				text: "Weather", 
				style: { color: '#89A54E' }
			},
			opposite: true
		}
		
		
		],	
		tooltip: {
			useHTML: true,
			formatter: function() {
				var s;
				if (this.point.name) { // the pie chart
					s = '' + this.point.name + ': '+ parseFloat(this.y).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:5}) + ' CF';
					s  += getUnitConversionToolTip(this.point.index )  ; 					
				} else if (this.series.name) {
					
					// For event flag series
					if(this.series.options.id === 'eventFlag'){
						s = this.point.text;
					}
					
					
					else if (this.series.options.id === "consumptionData_generation") {
						
						var hourStr = this.x;
					    
			             try {
			               index = xLabels.lastIndexOf(this.x);
			               if (index!=-1)
			            	 hourStr = xLabels[index-1] + " - " + this.x;
			             } catch (err){ }
			   			 
						
						
				             s = '' + this.x + ' <br> ' + parseFloat(this.y).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:5}) + ' CF  (' + this.series.name + ') ';
					         s  += getUnitConversionToolTip(this.point.index )  ; 				             
						
						
					}
					
					
					
					else if (this.series.options.id === "consumptionData_net") {
						
						var hourStr = this.x;
					    
			             try {
			               index = xLabels.lastIndexOf(this.x);
			               if (index!=-1)
			            	 hourStr = xLabels[index-1] + " - " + this.x;
			             } catch (err){ }
			   			 
						
						
						
							s = '' + this.x + ' <br> ' + parseFloat(this.y).toLocaleString('en-US') + ' CF  (' + this.series.name + ') ';
						
						
					}
					
					
					else if (this.series.options.id === "consumptionData_demand") {
						
						var hourStr = this.x;
					    
			             try {
			               index = xLabels.lastIndexOf(this.x);
			               if (index!=-1)
			            	 hourStr = xLabels[index-1] + " - " + this.x;
			             } catch (err){ }
			   			 
						
						
						
							s = '' + this.x + ' <br> ' + parseFloat(this.y).toLocaleString('en-US') + ' CF  (' + this.series.name + ') ';
						
						
					}
					
					else if (this.series.name.indexOf("peak") != -1) {

					    
					         var showUsageCostOnSmartMeterChart = false;
					    
						
						       var dailyOffPeakAmount = 0;
						       var dailyMidPeakAmount = 0;
						       var dailyOnPeakAmount = 0;
						       for (p=0; p<aTouDate.length; p++) {
						         //alert(aTouDate[p] + " vs " + this.x + " length=" + aTouDate.length);
						         if (aTouDate[p] == this.x) {
						           dailyOffPeakAmount = aTouOffPeakAmount[p];
						           dailyMidPeakAmount = aTouMidPeakAmount[p];
						           dailyOnPeakAmount = aTouOnPeakAmount[p];
						           break;
						         }
						       } // end for p
						
								s = '' + this.x + ' <br> ' 
										+ parseFloat(this.y).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:5}) 
										+ ' CF   ';
						         s  += getUnitConversionToolTip(this.point.index )  ; 						         
						         if (showUsageCostOnSmartMeterChart && dailyOffPeakAmount != 0) {
						        	 
						        	 s += '<br> $' + dailyOffPeakAmount;
						        	 
						         }
						
						
						
						
						
						
					} else if (this.series.name == "Usage") { // 2016-10-05 based on non-peak keyword in properties file for the series name
						
						
						     var dailyOffPeakAmount = 0;
				             for (p=0; p<aTouDate.length; p++) {
					           if (aTouDate[p] == this.x) {
					             dailyOffPeakAmount = aTouOffPeakAmount[p];
					             break;
					           }
					         } // end for p
					       
				             s = '' + this.x + ' <br> ' + parseFloat(this.y).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:5}) 
				             	+ ' CF   ';
				             s  += getUnitConversionToolTip(this.point.index )  ; 
				             if (showUsageCostOnSmartMeterChart && dailyOffPeakAmount != 0) {
				        	     
				        	     s += '<br> $' + dailyOffPeakAmount;
				        	     
				             }
						
						
					} else {
					    
							
						   
									      
										var value=this.series.name;
										if(this.series.options.id === "max_temperature" || this.series.options.id === "min_temperature" || this.series.options.id === "avg_temperature"){
											 s = this.x + ' <br> ' + this.series.name + ' = ' + Highcharts.numberFormat(this.y, 1).toLocaleString('en-US') + ' F';
										}else if(this.series.options.id === "max_humidity" || this.series.options.id === "avg_humidity" || this.series.options.id === "min_humidity"){
											s = this.x + ' <br> ' + this.series.name + ' = ' + Highcharts.numberFormat(this.y, 1).toLocaleString('en-US') + ' %';
										}else if(this.series.options.id === "precipitation"){
											s = this.x + ' <br> ' + this.series.name + ' = ' + Highcharts.numberFormat(this.y, 2).toLocaleString('en-US') + ' in';
										}else if(this.series.options.id === "degree_days"){
											var degreeTemperature = Highcharts.numberFormat(this.y, 1).toLocaleString('en-US');
											var labelForTooltip="Cooling Days";
											if(degreeTemperature < 0.0){
												labelForTooltip="Heating Days ";
											}		
											s = this.x + ' <br> ' + labelForTooltip + ' = ' + degreeTemperature + ' F';
										}else{
										     // CAP-1915: Edge case where offpeak water label changed to just "Usage", 
								             s = '' + this.x + ' <br> ' + parseFloat(this.y).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:5}) 
								             	+ ' CF   ';
								             s  += getUnitConversionToolTip(this.point.index )  ; 
										}
							
						
				    }		
				} else {
					s = '' + this.x + ': ' + parseFloat(this.y).toLocaleString('en-US');
				}
				return s;
			}, 
			style: { font: 'bold 8px "Helvetica Neue", Helvetica, Arial, sans-serif;' }
		},
		plotOptions: {
			column: {
				stacking: 'normal',
				dataLabels: {
					enabled: true,
					
					style:{
						textOutline: false
					},
					
					color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white'
				}
			},
			series: {
				cursor: 'pointer',
				stickyTracking: false, 
                
                point: {
                    events: {
                        click: function() {
                            showProcessingDialog();
                            location.href = "/app/capricorn?para=smartMeterConsum&type=hourly&inquiryType=water&day=" 
                            		+ this.category + "&fromDate=2025-07-06&toDate=2025-08-04" 
                            		+ "&tab=WATSMCON" 
                            		+ "&selectedMeterId=400027755" 
                            		+ "&selectedRegisterNumber="; 
                        }
                    }
                },
                 				
				events: {
				    
            		legendItemClick: function(event) {
                		var visibility = this.visible ? 'visible' : 'hidden';
                        //if (!confirm('The series is currently ' + visibility +'. Do you want to change that?')) {
                        //	return false;
                        //}
                                         
                        if ("Yes" != "Yes") {
                          if (this.name.indexOf("peak") != -1) return false; // not to hide on-peak, mid-peak and off-peak from the legend
                        }
                    }
                           	
                }
            }
        },		
		series: [
		
		
		
		{

			type: 'column',
			name: "Usage",
			color: '#8BC43F',
			data: [48.000, 105.000, 32.000, 103.000, 58.000, 47.000, 88.000, 60.000, 34.000, 84.000, 84.000, 42.000, 92.000, 82.000, 94.000, 86.000, 46.000, 48.000, 76.000, 47.000, 64.000, 114.000, 85.000, 61.000, 124.000, 61.000, 37.000, 80.000, 90.000, 29.000],
			dataLabels: {
				enabled: false
			},
			yAxis: 0,
			lineWidth: 2,
			showInLegend: true //330-526 AS
		}
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		 
			
		
		
			
		, {
			type: 'spline',
			id:'max_temperature',
			name: "Max. Daily Temperature",
			color: '#d32929',
			data: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
			yAxis: 1,		
			lineWidth: 2,
			visible: false
		}
		
		
		
		
		
		, {
			type: 'spline',
			id: 'avg_humidity',
			name: 'Average Humidity',
			color: '#EBA20F',
			data: [],
			yAxis: 1,
			lineWidth: 2,
			visible:false
		}
		
		
	
	
	
	
		
		
		
		
		
			
		
		
		]
	});
});






 $(document).ready(function() {

//    $('#dailyConsumptionUageChart').click(function() {
//      	showProcessingDialog();
//    });
//    $('#currentBillingChart').click(function() {
//      	showProcessingDialog();
//    });   
//    $('#hourlyUsage').click(function() {
//      	showProcessingDialog();
//    });
//    $('#usageComparison').click(function() {
//      	showProcessingDialog();
//    });
//    $('#refresh').click(function() {
//     	showProcessingDialog();
//    });
   
     
   $('area').click(function() {
     	showProcessingDialog();
   });
   
   $('#smNag').click(function() {
     	showProcessingDialog();
   });
   
   
   
   // init responsive datatable
   $(" #table-usageComparison, #table-usageComparisonWithContractPrice").DataTable({          
	 responsive:  true,
	 "paging":    false,
     "ordering":  false,
     "info":      false,
	 "searching": false,
	 "autoWidth": false,
	 "initComplete": function (oSettings, json) {
		// fix the issue of rendering responsive table on ios safari. 
		if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){
			var outerFrame = $(parent.document).find("#tabs-SMCONSUM");
			if (outerFrame.length > 0) { // CAP-1538 proceed only when the outer frame is found
				var width = outerFrame.width();
				$('#chart_container').css("width", width-10);
				$('#summary_container').css("width", width-45);
				/* $('.datatable-container').css("width", width-45);
				this.fnAdjustColumnSizing(true); */
			}
		}
	},
	 "drawCallback": function() {
		// add aria attribute to datatable to improve accessibility.
		this.attr("role", "presentation");
		this.find("thead th").attr("role", "columnheader");
    	this.find("td").attr("role", "gridcell");
	
	 }
   });
   
   
	
		var loadCustomEventWidgetUrl = "/app/capricorn?para=editCustomEvents&meterId=400027755&viewInChart=TOU&onSeriesID=consumptionData";
		$.ajax({
			type:"get",
		    cache: false,
		    url: loadCustomEventWidgetUrl,
		    success: function(data){
		    	$("#customEventWidget").html(data);
		    }
		 }); 
	
   
    
	
	
	
	
		
	
 });
 
 
now = new Date;
theYear = now.getYear();
if (theYear < 1900)
  theYear = theYear + 1900;

 
function processRequest(buttonFunction) {
  var validData = true;
  form = document.hydroInquiry
  form.action = "/app/capricorn"
  form.para.value = "consumptionInquiry"
  if (buttonFunction == "chart") {
    form.showChart.value = "Y"
  } else if (buttonFunction == "search") {
    form.action = "/app/capricorn";
    form.para.value = "selectAccount";
    form.userAction.value = "search";
  } else if (buttonFunction == "dailyUsageChart") {
    form.action = "/app/capricorn?para=smartMeterConsum&fromDate=2025-07-06&toDate=2025-08-04" 
    		+ "&inquiryType=water"
   			+ "&selectedMeterId=400027755" 
    		+ "&selectedRegisterNumber="; 
    		
  } else if (buttonFunction == "refreshChart") {
    if (form.year_from != undefined && form.year_from.value != "") {
    fromYear = form.year_from.value;
    fromMonth = form.month_from.value;
    fromDay = form.day_from.value;
    } else {
    fromYear = form.fromDate.value.substring(0,4);
    fromMonth = form.fromDate.value.substring(5,7);
    fromDay = form.fromDate.value.substring(8);
    }
    if (form.year_to != undefined && form.year_to.value != "") {
    toYear = form.year_to.value;
    toMonth = form.month_to.value;
    toDay = form.day_to.value;
    } else {
    toYear = form.toDate.value.substring(0,4);
    toMonth = form.toDate.value.substring(5,7);
    toDay = form.toDate.value.substring(8);
    }
    
    
    form.action = "/app/capricorn?para=smartMeterConsum&inquiryType=water&fromYear="+fromYear+"&fromMonth="+fromMonth+"&fromDay="+fromDay+"&toYear="+toYear+"&toMonth="+toMonth+"&toDay="+toDay;
    var fromDate = new Date(fromYear, fromMonth-1, fromDay);
    var toDate = new Date(toYear, toMonth-1, toDay);
  
    var daysDiff = daysBetween(fromDate, toDate);
    
    if (daysDiff < 0) {
      validData = false;
      alert("From Date cannot be greater than To Date");
    } else if (daysDiff > 90) {
      validData = false;
      alert("From Date and To Date cannot be more than");
    }
  } else if (buttonFunction == "usageComparison") {
    
    //fromYear = form.year_from.value;
    //fromMonth = form.month_from.value;
    //fromDay = form.day_from.value;
    //toYear = form.year_to.value;
    //toMonth = form.month_to.value;
    //toDay = form.day_to.value;
    fromYear = form.TOU_fromDate.value.substring(6);
    fromMonth = form.TOU_fromDate.value.substring(0,2);
    fromDay = form.TOU_fromDate.value.substring(3,5);
    toYear = form.TOU_toDate.value.substring(6);
    toMonth = form.TOU_toDate.value.substring(0,2);
    toDay = form.TOU_toDate.value.substring(3,5);   
    
    var contractPrice = $("#contractPrice").val();
    form.action = "/app/capricorn?para=usageComparison&inquiryType=water&fromYear="+fromYear+"&fromMonth="+fromMonth+"&fromDay="+fromDay+"&toYear="+toYear+"&toMonth="+toMonth+"&toDay="+toDay+"&tab=SMCOMPAR" + "&contractPrice=" + contractPrice;
    
    var fromDate = new Date(fromYear, fromMonth-1, fromDay);
    var toDate = new Date(toYear, toMonth-1, toDay); 
    var daysDiff = daysBetween(fromDate, toDate);
    if (daysDiff < 0) {
      validData = false;
      alert("From Date cannot be greater than To Date");
    } else if (daysDiff > 90) {
      validData = false;
      alert("From Date and To Date cannot be more than 90 days");
    }
    
  } else if (buttonFunction == "hourlyUsage") {
    form.para.value = "smartMeterConsum";
    form.type.value = "hourly";
    form.inquiryType.value = "water";
    form.day.value = "2025-08-04";
    form.tab.value = "WATSMCON"; 
    
    if(form.selectedMeterId != undefined){ 
    	form.selectedMeterId.value = "400027755"; 
    }
    if(form.selectedRegisterNumber != undefined){
    	form.selectedRegisterNumber.value = ""; 
    }
    
  } else if (buttonFunction == "currentBillingChart") {  
    
    	alert("Error: missing information on current billing date.");
       
  } else {
    form.action = "/app/index.jsp";
  }
  
  if (validData == true) {
    showProcessingDialog();
    form.submit();
  }
  return
}

// function downloadSmartMeterConsumptionHistory() {
//   form = document.hydroInquiry
//   form.downloadConsumption.value = "Y"

//   form.para.value = "smartMeterConsum"
//   form.submit()
// }

function downloadFiles() { //v2.0
  theURL = "/app/ExcelExport?key="
  window.open(theURL,'ConsumptionHistory','toolbar=yes,width=780,height=600,status=no,scrollbars=yes');
}

function daysBetween(fromDate, toDate) {
    var DSTAdjust = 0;
    // constants used for our calculations below
    const oneMinute = 1000 * 60;
    const oneDay = oneMinute * 60 * 24;
    // equalize times in case date objects have them
    fromDate.setHours(0);
    fromDate.setMinutes(0);
    fromDate.setSeconds(0);
    toDate.setHours(0);
    toDate.setMinutes(0);
    toDate.setSeconds(0);
    // take care of spans across Daylight Saving Time changes
    var diff = "";
    if (toDate > fromDate) {
        DSTAdjust = (toDate.getTimezoneOffset() - fromDate.getTimezoneOffset()) * oneMinute;
        diff = Math.abs(toDate.getTime() - fromDate.getTime()) - DSTAdjust;
    } else {
        DSTAdjust = (fromDate.getTimezoneOffset() - toDate.getTimezoneOffset()) * oneMinute;   
        diff = (toDate.getTime() - fromDate.getTime()) - DSTAdjust; 
    }
    var daysDiff = Math.ceil(diff/oneDay) + 1; 
    return daysDiff;
}

function processDownload() { // Change Number : 300-013

	 
   	if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){
	   var newDownloadTab = window.open('', '_blank');
	   newDownloadTab.document.write('Loading File...');
  }	
	
  var ajaxURL = "/app/capricorn?para=ajaxDownloadConsumptionData&type=smartmeter&inquiryType=water"; 
  $.ajax({type:"get",
     cache: false,
     url:ajaxURL,
     success: function(data){
       var encryptedKey = $.trim(data);
       
        
       if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){
    	   var downloadURL = "/app/ExcelExport?key=" + encryptedKey;
    	   newDownloadTab.location.href = downloadURL;
    	   
	   }else{
	       document.getElementById("downloadData").action = "/app/ExcelExport?key=" + encryptedKey;
	       document.downloadData.submit(); 
	   }
       
     }
  }); 
}




	$('#TOU_fromDate_picker').datetimepicker({
		format: 'MM/DD/YYYY',
				
		
	    	defaultDate: new Date(2025, 07-1, 06),
		
	    minDate: new Date(2011,0,1),
	    
	    	maxDate: new Date(2025, 08-1, 04),
	    
	    locale: 'en'
	
	}).on('dp.change', function (e) {
		if (e.date != null) { 
			$('#TOU_toDate_picker').data("DateTimePicker").minDate(e.date);		
		
			/* $(...).data("DateTimePicker").date() return moment Object. */
			var day1 = $("#TOU_fromDate_picker").data("DateTimePicker").date().date(); //  date() = date of month in the range from 1 to 31  
			var month1 = $("#TOU_fromDate_picker").data("DateTimePicker").date().month()+1;  // month() = month range from 0 to 11.
			var year1 = $("#TOU_fromDate_picker ").data("DateTimePicker").date().year(); 
			
			if (day1 < 10) day1 = "0" + day1;
			if (month1 < 10) month1 = "0" + month1;
			
			document.hydroInquiry.fromDate.value = year1 + "-" + month1 + "-" + day1;
			document.hydroInquiry.year_from.value = year1;
			document.hydroInquiry.month_from.value = month1;
			document.hydroInquiry.day_from.value = day1;
		}
	});
	
	
	$('#TOU_toDate_picker').datetimepicker({
		format: 'MM/DD/YYYY',
				
		
			defaultDate: new Date(2025, 08-1, 04),
		
	    
	    	minDate: new Date(2025, 07-1, 06),
	    
	    maxDate: new Date(),
	    locale: 'en'
	
	}).on('dp.change', function (e) {
		if (e.date != null) { 
			$('#TOU_fromDate_picker').data("DateTimePicker").maxDate(e.date);		
			
			/* $(...).data("DateTimePicker").date() return moment Object. */
			var day1 = $("#TOU_toDate_picker").data("DateTimePicker").date().date(); //  date() = date of month in the range from 1 to 31  
			var month1 = $("#TOU_toDate_picker").data("DateTimePicker").date().month()+1;  // month() = month range from 0 to 11.
			var year1 = $("#TOU_toDate_picker ").data("DateTimePicker").date().year(); 
			
			if (day1 < 10) day1 = "0" + day1;
			if (month1 < 10) month1 = "0" + month1;
			
			document.hydroInquiry.toDate.value = year1 + "-" + month1 + "-" + day1;
			document.hydroInquiry.year_to.value = year1;
			document.hydroInquiry.month_to.value = month1;
			document.hydroInquiry.day_to.value = day1;
		}
	});


function backToMyAccount(buttonName) {
  form = document.hydroInquiry;
  if (buttonName == "search") {
    form.action = "/app/capricorn";
    form.para.value = "selectAccount";
    form.userAction.value = "search";
    form.submit();
  } else {
    form.action = "/app/index.jsp";
    form.submit();
  }
}

// refresh the TOU chart by given fromDate, toDate. (being used by View User Event in Chart.) 
function refreshChartByDateRange(fromDate, toDate) {
	 if(document.hydroInquiry){	
		 form = document.hydroInquiry;
		 form.fromDate.value = fromDate;
		 form.toDate.value= toDate;
		 processRequest('refreshChart');
	}
}

function switchInquiryType() {
	if(document.hydroInquiry){
		   
		  		var selectedMeter = $("#selectedMeterId").find('option:selected');
		  		var register = selectedMeter.data('register'); 
		  		$("#selectedRegister").val(register);
		  
		  
		 processRequest('refreshChart');
	}
}

</script>

</body>
</html>

